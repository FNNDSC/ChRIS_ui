import{r as l,j as n,A as C,R as m,T as M,a as F,b as A,u as z,c as S,h as x,d as T,e as k,f as N,g as O,l as B,i as U,k as $,w as J,m as I,C as P,n as h,o as R,H as W,p as _,q as j,s as g,S as G,t as H}from"./index-bb983539.js";const V=t=>(()=>{const{fileItem:i}=t,c=i.fileType?i.fileType:"",s=n.jsxs(l.Fragment,{children:[n.jsx("label",{}),n.jsx("br",{}),n.jsxs("label",{children:[n.jsx("b",{children:"File Type:"})," ",c]})]});return n.jsx(C,{variant:"info",title:`No preview available for the filetype ${c}`,children:s})})(),K=l.memo(V),q=t=>{const e=l.useContext(M),[i,c]=l.useState({}),{fileItem:s}=t,d=l.useRef(!1),f=m.useCallback(()=>{const{blob:u}=s;if(u){const r=new FileReader;r.addEventListener("loadend",a=>{const o=a.target.result;d.current===!0&&c(JSON.parse(o))}),r.readAsText(u)}},[s]);return l.useEffect(()=>(d.current=!0,f(),()=>{d.current=!1}),[f]),f(),n.jsx(n.Fragment,{children:i?n.jsx(F,{theme:e?"grayscale":"tomorrow",name:!1,displayDataTypes:!1,src:i,displayObjectSize:!1,collapsed:!1}):n.jsx(A,{component:"p",children:"Could not load json payload at the moment...."})})},Y=m.memo(q),Z=t=>{const{fileItem:e}=t;let i="";return e.fileType==="html"?i=e.blob?window.URL.createObjectURL(new Blob([e.blob],{type:"text/html"})):"":i=e.blob?window.URL.createObjectURL(new Blob([e.blob])):"",n.jsx(l.Fragment,{children:n.jsx("div",{className:"iframe-container",children:n.jsx("iframe",{id:"myframe",src:i,width:"100%",height:"100%",title:"Gallery"},e.file&&e.file.data.fname)})})},Q=m.memo(Z),ee=t=>{const{fileItem:e}=t,i=e.blob?window.URL.createObjectURL(new Blob([e.blob])):"";return n.jsx("img",{id:t.fileItem.file?t.fileItem.file.data.fname:"",src:i,alt:""})},te=m.memo(ee),ae=t=>{const e=l.useRef(null),{fileItem:i,preview:c}=t,s=z(a=>a.drawers);S(e);const d=()=>{const a=e.current;a&&J(a)};(s.preview.maximized===!0||s.preview.maximized===!1&&s.preview.open===!0)&&d();const f=l.useCallback((a,o)=>{a==="Zoom"&&x(a,o),a==="Pan"&&x(a,o),a==="Magnify"&&x(a,o),a==="Rotate"&&e.current&&T(e.current),a==="Wwwc"&&x(a,o),a==="Reset View"&&e.current&&k(e.current),a==="Length"&&x(a,o)},[]);l.useEffect(()=>{if(t.actionState){const a=Object.keys(t.actionState)[0];f(a,t.actionState[a])}},[t.actionState,f]);const u=a=>{switch(a.key){case"ArrowDown":{e.current&&T(e.current);break}case"+":{e.current&&I(e.current,"+");break}case"-":{e.current&&I(e.current,"-");break}case"r":{e.current&&k(e.current);break}}};l.useEffect(()=>(window.addEventListener("keydown",u),window.addEventListener("resize",d),()=>{window.removeEventListener("keydown",u),window.removeEventListener("resize",d)}),[]);const r=l.useCallback(a=>{var w;const{blob:o}=a,p=e.current;if(p){N(p);let y;O((w=a.file)==null?void 0:w.data.fname)==="dcm"?y=B(o):y=U(o),$(y,p)}},[]);return l.useEffect(()=>{i&&r(i)},[i,r]),n.jsx("div",{className:c==="large"?"dcm-preview":"",children:n.jsx("div",{ref:e,id:"container"})})},ne=({fileItem:t})=>{const e=t.blob?window.URL.createObjectURL(new Blob([t.blob],{type:"application/pdf"})):"";return n.jsx("div",{className:"iframe-container",children:n.jsx("iframe",{src:e,width:"100%",height:"100%",title:"Gallery"},t.file&&t.file.data.fname)})},v=new P,se=v.get("username"),ie=v.get(`${se}_token`);h.external.cornerstone=R;h.external.Hammer=W;h.external.cornerstoneMath=_;h.init();j.external.cornerstone=R;j.nifti.configure({headers:{"Content-Type":"application/vnd.collection+json",Authorization:"Token "+ie},method:"get",responseType:"arrayBuffer"});const re=j.nifti.ImageId,oe=h.StackScrollMouseWheelTool;h.addTool(oe);h.setToolActive("StackScrollMouseWheel",{});const le=t=>{const[e,i]=m.useState(!1),c=m.useRef(null),{fileItem:s}=t,d=m.useCallback(async f=>{const{blob:u,file:r}=f,a=[];let o=0;if(i(!0),u&&r){const p=r.data.fname.split("/"),w=p[p.length-1],y=re.fromURL(`nifti:${r.url}${w}`),E=await g.loadAndCacheImage(y.url);o=g.metaData.get("multiFrameModule",y.url).numberOfFrames,a.push(...Array.from(Array(o),(D,L)=>`nifti:${y.filePath}#${y.slice.dimension}-${L},t-0`));const b=c.current;if(b){g.enable(b);const D={currentImageIdIndex:0,imageIds:a};g.displayImage(b,E),h.addStackStateManager(b,["stack"]),h.addToolState(b,"stack",D),i(!1)}}},[]);return m.useEffect(()=>{s&&d(s)},[s,d]),n.jsx(n.Fragment,{children:n.jsx("div",{style:{width:"100%",height:"512px",position:"relative",fontSize:"1rem",textShadow:"1px 1px #000000"},ref:c,children:e?n.jsx(G,{title:"Loading files into cornerstone"}):n.jsx(n.Fragment,{children:n.jsx("div",{id:"dicomImageWebGL"})})})})},ce=({fileItem:t})=>{var c;const e=H(t.fileType);l.useEffect(()=>{let s;async function d(){var a,o;const f=await((a=t.blob)==null?void 0:a.arrayBuffer()),u=(o=t.file)==null?void 0:o.data.fname;let r;if(e==="volume")s=new X.renderer2D,s.orientation="x",r=new X.volume,r.file=u,r.filedata=f;else if(e==="mesh")s=new X.renderer3D,r=new X.mesh,r.file=u,r.filedata=f;else return;s.container=i.current,s.init(),s.add(r),s.camera.position=[0,400,0],s.render()}return d(),()=>{s&&s.destroy()}},[t.blob,(c=t.file)==null?void 0:c.data.fname,e]);const i=l.useRef(null);return n.jsx("div",{style:{height:"100%"},children:e==="other"?n.jsx("div",{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center",marginTop:-40,fontSize:18,fontStyle:"italic"},children:"Please open the XTK Viewer to preview this file"}):n.jsx("div",{style:{height:"100%",background:"black"},ref:i})})},de=t=>{const e=m.useRef(null),{fileItem:i}=t;return S(e),m.useEffect(()=>{const c=document.getElementById("text-display");if(c){const s=new FileReader;s.addEventListener("load",()=>{c.innerText=s.result},!1),i.blob&&s.readAsText(i.blob)}},[i]),n.jsx(l.Fragment,{children:n.jsx("div",{ref:e,style:{display:"block",overflowY:"scroll",width:"100%"},children:n.jsx("span",{id:"text-display",style:{fontFamily:"monospace",color:"white"}})})})},fe=m.memo(de),me={JsonDisplay:Y,IframeDisplay:Q,ImageDisplay:te,DcmDisplay:ae,CatchallDisplay:K,PdfDisplay:ne,NiftiDisplay:le,XtkDisplay:ce,TextDisplay:fe},he=t=>{const e=me[t.viewerName||"CatchallDisplay"];return n.jsx(e,{...t})};export{he as default};
